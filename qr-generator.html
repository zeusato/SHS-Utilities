<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="Source/Thumb.png">
    <link rel="icon" href="Source/LOGO.png" type="image/png">
    <title>T·∫°o QR ƒêa D·ª•ng</title>
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        .header {
            width: 100%;
            max-width: 800px;
            background: #FFFFFF;
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        .logo img {
            height: 40px;
            width: auto;
        }
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #32336e;
        }
        .back-btn {
            background: #10a37f;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        .back-btn:hover {
            background: #1a7f64;
        }
        .main-content {
            background: white;
            border-radius: 0 0 16px 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
        }
        .page-title {
            text-align: center;
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 2rem;
            font-weight: 700;
        }
        .qr-container {
            display: flex;
            gap: 2rem;
        }
        .qr-form {
            flex: 1;
        }
        .qr-preview {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #canvas {
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
        }
        input, select, textarea {
            width: 100%;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            width: 100%;
            background: #10a37f;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        button:hover {
            background: #1a7f64;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">
            <img src="Source/1. Logo.png" alt="Logo">
            <span class="logo-text">Utilities</span>
        </a>
        <a href="index.html" class="back-btn">‚Üê Quay l·∫°i</a>
    </header>
    <div class="main-content">
        <h1 class="page-title">üî≥ T·∫°o QR ƒêa D·ª•ng</h1>
        <div class="qr-container">
            <div class="qr-form">
                <div class="form-group">
                    <label for="qr-type">Lo·∫°i QR</label>
                    <select id="qr-type">
                        <option value="link">Link/Text</option>
                        <option value="vcard">Vcard</option>
                        <option value="wifi">Wi-Fi</option>
                    </select>
                </div>
                <div id="form-fields"></div>
                <div class="form-group">
                    <label for="image-upload">Logo</label>
                    <input type="file" id="image-upload" accept="image/*">
                </div>
            </div>
            <div class="qr-preview">
                <div id="canvas"></div>
                <button id="download-btn">T·∫£i xu·ªëng</button>
            </div>
        </div>
    </div>
    <script>
        const qrTypeSelect = document.getElementById('qr-type');
        const formFields = document.getElementById('form-fields');
        const downloadBtn = document.getElementById('download-btn');
        const canvas = document.getElementById('canvas');
        const imageUpload = document.getElementById('image-upload');

        let qrCode;

        const qrCodeOptions = {
            width: 300,
            height: 300,
            type: "svg",
            data: " ",
            dotsOptions: {
                color: "#6a1a4c",
                type: "rounded"
            },
            cornersSquareOptions: {
                color: "#000000",
                type: "extra-rounded"
            },
            backgroundOptions: {
                color: "#ffffff",
            },
            imageOptions: {
                crossOrigin: "anonymous",
                margin: 1
            },
            qrOptions: {
                errorCorrectionLevel: 'H',
                mode: 'Byte'
            },
            qrOptions: {
                errorCorrectionLevel: 'H',
                mode: 'Byte'
            },
            qrOptions: {
                errorCorrectionLevel: 'H',
                mode: 'Byte'
            }
        };

        const linkTemplate = `
            <div class="form-group">
                <label for="text-input">N·ªôi dung</label>
                <textarea id="text-input" rows="4" maxlength="500" required></textarea>
            </div>
        `;

        const vcardTemplate = `
            <div class="form-group">
                <label for="vcard-name">H·ªç t√™n</label>
                <input type="text" id="vcard-name" required>
            </div>
            <div class="form-group">
                <label for="vcard-phone">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="tel" id="vcard-phone" pattern="[0-9]+">
            </div>
            <div class="form-group">
                <label for="vcard-email">Email</label>
                <input type="email" id="vcard-email">
            </div>
            <div class="form-group">
                <label for="vcard-company">C√¥ng ty</label>
                <input type="text" id="vcard-company">
            </div>
            <div class="form-group">
                <label for="vcard-title">Ch·ª©c danh</label>
                <input type="text" id="vcard-title">
            </div>
        `;

        const wifiTemplate = `
            <div class="form-group">
                <label for="wifi-ssid">T√™n m·∫°ng (SSID)</label>
                <input type="text" id="wifi-ssid" required>
            </div>
            <div class="form-group">
                <label for="wifi-password">M·∫≠t kh·∫©u</label>
                <input type="text" id="wifi-password">
            </div>
            <div class="form-group">
                <label for="wifi-security">Ph∆∞∆°ng th·ª©c b·∫£o m·∫≠t</label>
                <select id="wifi-security">
                    <option value="WPA">WPA</option>
                    <option value="WEP">WEP</option>
                    <option value="None">None</option>
                </select>
            </div>
        `;

        function updateFormFields() {
            const selectedType = qrTypeSelect.value;
            if (selectedType === 'link') {
                formFields.innerHTML = linkTemplate;
            } else if (selectedType === 'vcard') {
                formFields.innerHTML = vcardTemplate;
            } else if (selectedType === 'wifi') {
                formFields.innerHTML = wifiTemplate;
            }
            attachFormListeners();
        }

        function attachFormListeners() {
            const inputs = formFields.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.addEventListener('input', generateQRCode);
            });
        }

        function removeVietnameseTones(str) {
            str = str.replace(/√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ/g,"a");
            str = str.replace(/√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ/g,"e");
            str = str.replace(/√¨|√≠|·ªã|·ªâ|ƒ©/g,"i");
            str = str.replace(/√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°/g,"o");
            str = str.replace(/√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ/g,"u");
            str = str.replace(/·ª≥|√Ω|·ªµ|·ª∑|·ªπ/g,"y");
            str = str.replace(/ƒë/g,"d");
            str = str.replace(/√Ä|√Å|·∫†|·∫¢|√É|√Ç|·∫¶|·∫§|·∫¨|·∫®|·∫™|ƒÇ|·∫∞|·∫Æ|·∫∂|·∫≤|·∫¥/g, "A");
            str = str.replace(/√à|√â|·∫∏|·∫∫|·∫º|√ä|·ªÄ|·∫æ|·ªÜ|·ªÇ|·ªÑ/g, "E");
            str = str.replace(/√å|√ç|·ªä|·ªà|ƒ®/g, "I");
            str = str.replace(/√í|√ì|·ªå|·ªé|√ï|√î|·ªí|·ªê|·ªò|·ªî|·ªñ|∆†|·ªú|·ªö|·ª¢|·ªû|·ª†/g, "O");
            str = str.replace(/√ô|√ö|·ª§|·ª¶|≈®|∆Ø|·ª™|·ª®|·ª∞|·ª¨|·ªÆ/g, "U");
            str = str.replace(/·ª≤|√ù|·ª¥|·ª∂|·ª∏/g, "Y");
            str = str.replace(/ƒê/g, "D");
            // Some system encode vietnamese combining accent as individual utf-8 characters
            // M·ªôt v√†i b·ªô encode coi c√°c d·∫•u m≈©, d·∫•u ch·ªØ, d·∫•u h·ªèi, d·∫•u ng√£, d·∫•u n·∫∑ng l√† c√°c k√Ω t·ª± ri√™ng
            str = str.replace(/\u0300|\u0301|\u0303|\u0309|\u0323/g, ""); // ÃÄ ÃÅ ÃÉ Ãâ Ã£  huy·ªÅn, s·∫Øc, ng√£, h·ªèi, n·∫∑ng
            str = str.replace(/\u02C6|\u0306|\u031B/g, ""); // ÀÜ ÃÜ Ãõ  m≈©, trƒÉng, r√¢u
            // Remove extra spaces
            // B·ªè c√°c kho·∫£ng tr·∫Øng li·ªÅn nhau
            str = str.replace(/ + /g," ");
            str = str.trim();
            return str;
        }

        function generateQRCode() {
            const selectedType = qrTypeSelect.value;
            let data = '';

            if (selectedType === 'link') {
                data = removeVietnameseTones(document.getElementById('text-input').value);
            } else if (selectedType === 'vcard') {
                const name = removeVietnameseTones(document.getElementById('vcard-name').value);
                const phone = document.getElementById('vcard-phone').value;
                const email = document.getElementById('vcard-email').value;
                const company = removeVietnameseTones(document.getElementById('vcard-company').value);
                const title = removeVietnameseTones(document.getElementById('vcard-title').value);
                data = `BEGIN:VCARD
VERSION:3.0
FN:${name}
ORG:${company}
TITLE:${title}
TEL:${phone}
EMAIL:${email}
END:VCARD`;
            } else if (selectedType === 'wifi') {
                const ssid = document.getElementById('wifi-ssid').value;
                const password = document.getElementById('wifi-password').value;
                const security = document.getElementById('wifi-security').value;
                data = `WIFI:T:${security};S:${ssid};P:${password};;`;
            }

            if (!data) {
                data = " ";
            }

            if (selectedType === 'vcard') {
                console.log("vCard Data:", data);
            }

            qrCodeOptions.data = data;
            
            if (qrCode) {
                qrCode.update(qrCodeOptions);
            } else {
                qrCode = new QRCodeStyling(qrCodeOptions);
                qrCode.append(canvas);
            }
        }

        downloadBtn.addEventListener('click', () => {
            if (qrCode) {
                qrCode.download({ name: "qr-code", extension: "png" });
            }
        });

        qrTypeSelect.addEventListener('change', updateFormFields);
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    qrCodeOptions.image = event.target.result;
                    generateQRCode();
                };
                reader.readAsDataURL(file);
            }
        });

        // Initial setup
        updateFormFields();
        generateQRCode();
    </script>
</body>
</html>



